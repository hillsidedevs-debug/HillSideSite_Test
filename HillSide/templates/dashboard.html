{% extends "basic.html" %}
{% block content %}
<div class="container my-5">
  <div class="text-center mb-5">
    <div class="d-inline-flex align-items-center gap-4 bg-white rounded-4 shadow-sm p-4">
      {% if current_user.photo %}
        <img src="{{ url_for('static', filename='uploads/photos/' ~ current_user.photo) }}"
             class="rounded-circle border border-3 border-white shadow"
             width="100" height="100"
             alt="{{ current_user.username }}">
      {% else %}
        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center shadow"
             style="width: 100px; height: 100px; font-size: 2.5rem;">
          {{ current_user.first_name[0]|upper }}{{ current_user.last_name[0]|upper }}
        </div>
      {% endif %}

      <div class="text-start">
        <h1 class="fw-bold mb-1">My Dashboard</h1>
        <p class="text-muted mb-0">
          Welcome back, <strong>{{ current_user.first_name }} {{ current_user.last_name }}</strong>
          {% if current_user.city_town %}from {{ current_user.city_town }}{% endif %}
        </p>
        <small class="text-muted">@{{ current_user.username }} â€¢ {{ current_user.email }}</small>
      </div>
    </div>
  </div>
  
  <!-- Tabs -->
  <ul class="nav nav-pills nav-fill mb-4" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="courses-tab" data-bs-toggle="pill" data-bs-target="#courses" type="button">
        My Courses
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="profile-tab" data-bs-toggle="pill" data-bs-target="#profile" type="button">
        My Profile Settings
      </button>
    </li>
  </ul>

  <div class="tab-content" id="dashboardTabsContent">

    <!-- ==================== MY COURSES TAB ==================== -->
    <div class="tab-pane fade show active" id="courses" role="tabpanel">
      {% if enrollments %}
        <div class="row g-4">
          {% for enrollment in enrollments %}
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-lift">
                {% if enrollment.course.image %}
                  <img src="{{ url_for('static', filename='uploads/courses/' ~ enrollment.course.image) }}"
                       class="card-img-top" style="height: 180px; object-fit: cover;" alt="{{ enrollment.course.title }}">
                {% else %}
                  <div class="bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                    <i class="bi bi-book fs-1 text-muted"></i>
                  </div>
                {% endif %}

                <div class="card-body d-flex flex-column">
                  <h5 class="card-title fw-bold">{{ enrollment.course.title }}</h5>
                  <p class="small text-muted mb-1"><strong>Enrolled:</strong> {{ enrollment.enrolled_on.strftime('%b %d, %Y') }}</p>
                  <p class="small text-muted mb-1"><strong>Status:</strong> 
                    <span class="badge bg-{% if enrollment.status == 'completed' %}success{% elif enrollment.status == 'dropped' %}secondary{% else %}info{% endif %}">
                      {{ enrollment.status|capitalize }}
                    </span>
                  </p>
                  <p class="small text-muted mb-2"><strong>Progress:</strong> {{ enrollment.progress|round(1) }}%</p>
                  <div class="mt-auto text-center">
                    <a href="{{ url_for('courses.course_details', course_id=enrollment.course.id) }}"
                       class="btn btn-outline-primary rounded-pill px-4 btn-sm">
                      View Course
                    </a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5">
          <i class="bi bi-emoji-smile fs-1 text-secondary"></i>
          <p class="text-muted fs-5 mt-3">You haven't enrolled in any courses yet.</p>
          <a href="{{ url_for('courses.list_courses') }}" class="btn btn-primary rounded-pill px-4">
            Browse Courses
          </a>
        </div>
      {% endif %}
    </div>

    <!-- ==================== PROFILE EDIT TAB ==================== -->
    <div class="tab-pane fade" id="profile" role="tabpanel">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm rounded-4">
            <div class="card-header bg-white">
              <h4 class="mb-0">Edit Your Profile</h4>
            </div>
            <div class="card-body">
              <form method="POST" action="{{ url_for('auth.update_profile') }}" enctype="multipart/form-data">
                {{ form.hidden_tag() if form else '' }}

                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">First Name</label>
                    <input type="text" name="first_name" class="form-control" value="{{ current_user.first_name }}" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Last Name</label>
                    <input type="text" name="last_name" class="form-control" value="{{ current_user.last_name }}" required>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Username</label>
                    <input type="text" name="username" class="form-control" value="{{ current_user.username }}" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-control" value="{{ current_user.email }}" required>
                  </div>

                  <div class="col-12">
                    <label class="form-label">Phone Number</label>
                    <input type="text" name="phone_number" class="form-control" value="{{ current_user.phone_number or '' }}" placeholder="+254 700 000 000">
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Gender</label>
                    <select name="gender" class="form-select">
                      <option value="">Prefer not to say</option>
                      <option value="M" {% if current_user.gender == 'M' %}selected{% endif %}>Male</option>
                      <option value="F" {% if current_user.gender == 'F' %}selected{% endif %}>Female</option>
                      <option value="Other" {% if current_user.gender == 'Other' %}selected{% endif %}>Other</option>
                      <option value="Prefer not to say" {% if current_user.gender == 'Prefer not to say' %}selected{% endif %}>Prefer not to say</option>
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Education Level</label>
                    <input type="text" name="education_qualification" class="form-control"
                           value="{{ current_user.education_qualification or '' }}" placeholder="e.g. Bachelor's in Computer Science">
                  </div>

                  <div class="col-12">
                    <label class="form-label">Address</label>
                    <textarea name="address" class="form-control" rows="3" placeholder="Full postal address (optional)">{{ current_user.address or '' }}</textarea>
                  </div>

                  <div class="col-12">
                    <label class="form-label">Profile Photo</label>
                    <input type="file" name="photo" class="form-control" accept="image/*">
                    {% if current_user.photo %}
                      <div class="mt-2">
                        <img src="{{ url_for('static', filename='uploads/users/' ~ current_user.photo) }}" class="rounded-circle" width="80" height="80" alt="Current photo">
                        <small class="text-muted ms-2">Current photo</small>
                      </div>
                    {% endif %}
                  </div>

                  <div class="col-12">
                    <label class="form-label">Resume / CV (PDF)</label>
                    <input type="file" name="resume" class="form-control" accept=".pdf">
                    {% if current_user.resume %}
                      <small class="text-success">Resume uploaded</small>
                    {% endif %}
                  </div>
                </div>

                <div class="text-center mt-4">
                  <button type="submit" class="btn btn-success btn-lg rounded-pill px-5">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<style>
.hover-lift {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.hover-lift:hover {
  transform: translateY(-8px);
  box-shadow: 0 1rem 2rem rgba(0,0,0,0.15);
}
</style>
{% endblock %}